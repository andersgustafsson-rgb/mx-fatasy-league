<!DOCTYPE html>
<html lang="sv">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>{{ target_user.username }}'s Profil - MX Fantasy League</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    // Suppress Tailwind CDN warning in production
    if (window.location.hostname !== 'localhost' && window.location.hostname !== '127.0.0.1') {
      console.warn = function() {}; // Suppress console warnings in production
    }
  </script>
</head>
<body class="relative font-sans min-h-screen text-gray-200">
  <!-- Bakgrund -->
  <div
    class="absolute inset-0 bg-cover bg-center"
    style="background-image: url('{{ url_for("static", filename="images/huvudsida.jpg") }}');"
  ></div>
  <div class="absolute inset-0 bg-black bg-opacity-70"></div>

  <!-- Innehåll -->
  <div class="relative z-10">
    <div class="container mx-auto p-4 md:p-8">
      <!-- Header -->
      <div class="mb-6 md:mb-8">
        <div class="flex flex-col sm:flex-row sm:justify-between sm:items-center gap-4">
          <header class="text-center sm:text-left">
            <h1 class="text-3xl sm:text-4xl md:text-5xl font-bold text-yellow-400">MX Fantasy League</h1>
            <p class="text-base md:text-lg text-gray-200 mt-2">
              {{ target_user.username }}'s Profil
            </p>
          </header>
          
          <!-- Navigation -->
          <div class="flex flex-wrap justify-center sm:justify-end gap-2 sm:gap-4">
            <a
              href="{{ url_for('index') }}"
              class="bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 px-3 sm:px-4 rounded shadow nav-sound text-sm sm:text-base"
            >
              Tillbaka till Huvudsidan
            </a>
            <a
              href="{{ url_for('profile_page') }}"
              class="bg-pink-600 hover:bg-pink-700 text-white font-bold py-2 px-3 sm:px-4 rounded shadow nav-sound text-sm sm:text-base"
            >
              Min Profil
            </a>
          </div>
        </div>
      </div>

      <!-- Flash Messages -->
      {% with messages = get_flashed_messages(with_categories=true) %}
        {% if messages %}
          <div class="mb-6">
            {% for category, message in messages %}
              <div class="alert alert-{{ category }} p-4 rounded-lg mb-2
                {% if category == 'success' %}bg-green-600 text-white
                {% elif category == 'error' %}bg-red-600 text-white
                {% elif category == 'warning' %}bg-yellow-600 text-white
                {% else %}bg-blue-600 text-white{% endif %}">
                {{ message }}
              </div>
            {% endfor %}
          </div>
        {% endif %}
      {% endwith %}

      <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 lg:gap-8">
        <!-- Profilinformation -->
        <div class="bg-white bg-opacity-90 dark:bg-gray-800 dark:bg-opacity-90 p-6 rounded-lg shadow-lg">
          <h2 class="text-2xl font-bold text-blue-500 mb-4">Profilinformation</h2>
          
          <!-- Profilbild -->
          <div class="flex items-center gap-4 mb-6">
            {% if target_user.profile_picture_url %}
              {% if target_user.profile_picture_url.startswith('data:') %}
                <img src="{{ target_user.profile_picture_url }}" 
                     alt="Profilbild" 
                     class="w-20 h-20 rounded-full object-cover border-4 border-blue-400">
              {% else %}
                <img src="{{ url_for('static', filename=target_user.profile_picture_url) }}" 
                     alt="Profilbild" 
                     class="w-20 h-20 rounded-full object-cover border-4 border-blue-400"
                     onerror="this.style.display='none'; this.nextElementSibling.style.display='flex';">
                <div class="w-20 h-20 rounded-full bg-gray-600 flex items-center justify-center border-4 border-blue-400" style="display:none;">
                  <span class="text-blue-400 text-2xl font-bold">{{ target_user.username[0].upper() }}</span>
                </div>
              {% endif %}
            {% else %}
              <div class="w-20 h-20 rounded-full bg-gray-600 flex items-center justify-center border-4 border-blue-400">
                <span class="text-blue-400 text-2xl font-bold">{{ target_user.username[0].upper() }}</span>
              </div>
            {% endif %}
            <div>
              <h3 class="text-xl font-bold text-gray-800 dark:text-gray-200">{{ target_user.username }}</h3>
              {% if target_user.display_name %}
                <p class="text-gray-600 dark:text-gray-400">{{ target_user.display_name }}</p>
              {% endif %}
            </div>
          </div>

          <!-- Användarinfo -->
          <div class="space-y-3">
            <div>
              <label class="block text-sm font-medium text-gray-700 dark:text-gray-300">Användarnamn</label>
              <p class="text-gray-800 dark:text-gray-200 font-medium">{{ target_user.username }}</p>
            </div>
            
            {% if target_user.display_name %}
            <div>
              <label class="block text-sm font-medium text-gray-700 dark:text-gray-300">Visningsnamn</label>
              <p class="text-gray-800 dark:text-gray-200">{{ target_user.display_name }}</p>
            </div>
            {% endif %}
            
            {% if target_user.bio %}
            <div>
              <label class="block text-sm font-medium text-gray-700 dark:text-gray-300">Om mig</label>
              <p class="text-gray-800 dark:text-gray-200">{{ target_user.bio }}</p>
            </div>
            {% endif %}
            
            {% if target_user.favorite_rider %}
            <div>
              <label class="block text-sm font-medium text-gray-700 dark:text-gray-300">Favoritförare</label>
              <p class="text-gray-800 dark:text-gray-200">{{ target_user.favorite_rider }}</p>
            </div>
            {% endif %}
            
            {% if target_user.favorite_team %}
            <div>
              <label class="block text-sm font-medium text-gray-700 dark:text-gray-300">Favoritlag</label>
              <p class="text-gray-800 dark:text-gray-200">{{ target_user.favorite_team }}</p>
            </div>
            {% endif %}
            
            {% if target_user.created_at %}
            <div>
              <label class="block text-sm font-medium text-gray-700 dark:text-gray-300">Medlem sedan</label>
              <p class="text-gray-800 dark:text-gray-200">{{ target_user.created_at.strftime('%d %B %Y') }}</p>
            </div>
            {% endif %}
          </div>
        </div>

        <!-- Säsongsteam -->
        <div class="bg-white bg-opacity-90 dark:bg-gray-800 dark:bg-opacity-90 p-6 rounded-lg shadow-lg">
          <h2 class="text-2xl font-bold text-green-500 mb-4">Säsongsteam</h2>
          
          {% if season_team %}
            <div class="mb-4">
              <p class="text-lg font-semibold text-gray-800 dark:text-gray-200">
                Teamnamn: <span class="text-green-600">{{ season_team.team_name }}</span>
              </p>
              <p class="text-xl font-bold text-green-600 dark:text-green-400">
                Totala poäng: {{ season_team.total_points or 0 }}
              </p>
            </div>

            {% if team_riders %}
              <div class="space-y-2">
                <h4 class="text-lg font-semibold text-gray-700 dark:text-gray-300">Riders:</h4>
                {% for r in team_riders %}
                <div class="flex items-center gap-3 bg-gray-100 dark:bg-gray-700 rounded px-3 py-2">
                  {% if r.image_url %}
                    <img src="{{ url_for('static', filename=r.image_url) }}"
                         alt="{{ r.name }} headshot"
                         class="w-8 h-8 rounded-full object-cover"
                         onerror="this.style.display='none'; this.nextElementSibling.style.display='flex';">
                    <div class="w-8 h-8 rounded-full bg-gray-600 flex items-center justify-center" style="display:none;">
                      <span class="text-white text-xs font-bold">#{{ r.number }}</span>
                    </div>
                  {% else %}
                    <div class="w-8 h-8 rounded-full bg-gray-600 flex items-center justify-center">
                      <span class="text-white text-xs font-bold">#{{ r.number }}</span>
                    </div>
                  {% endif %}
                  <div class="flex-1">
                    <span class="font-medium text-gray-800 dark:text-gray-200">#{{ r.number }} {{ r.name }}</span>
                    <span class="text-sm text-gray-600 dark:text-gray-400 ml-2">({{ r.class }})</span>
                  </div>
                </div>
                {% endfor %}
              </div>
            {% else %}
              <p class="text-gray-600 dark:text-gray-400">Inga riders i teamet än.</p>
            {% endif %}
          {% else %}
            <p class="text-gray-600 dark:text-gray-400">Inget säsongsteam skapat än.</p>
          {% endif %}
        </div>
      </div>

      <!-- Aktuella picks -->
      {% if current_picks_450 or current_picks_250 %}
      <div class="mt-6">
        <div class="bg-white bg-opacity-90 dark:bg-gray-800 dark:bg-opacity-90 p-6 rounded-lg shadow-lg">
          <h2 class="text-2xl font-bold text-purple-500 mb-4">Aktuella Race Picks</h2>
          
          {% if upcoming_race %}
            <p class="text-gray-600 dark:text-gray-400 mb-4">
              För {{ upcoming_race.name }} ({{ upcoming_race.event_date.strftime('%Y-%m-%d') if upcoming_race.event_date else '' }})
            </p>
          {% endif %}
          
          {% if picks_locked %}
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
              <!-- 450cc picks -->
              {% if current_picks_450 %}
              <div class="bg-gray-100 dark:bg-gray-700 rounded-lg p-4">
                <h4 class="text-lg font-semibold text-gray-700 dark:text-gray-300 mb-3">450cc Picks</h4>
                <div class="space-y-2">
                  {% for pick in current_picks_450 %}
                  <div class="flex items-center justify-between text-sm">
                    <span class="text-gray-600 dark:text-gray-400 font-medium">{{ pick.position }}.</span>
                    <span class="text-gray-800 dark:text-gray-200">#{{ pick.rider_number }} {{ pick.rider_name }}</span>
                  </div>
                  {% endfor %}
                </div>
              </div>
              {% endif %}
              
              <!-- 250cc picks -->
              {% if current_picks_250 %}
              <div class="bg-gray-100 dark:bg-gray-700 rounded-lg p-4">
                <h4 class="text-lg font-semibold text-gray-700 dark:text-gray-300 mb-3">250cc Picks</h4>
                <div class="space-y-2">
                  {% for pick in current_picks_250 %}
                  <div class="flex items-center justify-between text-sm">
                    <span class="text-gray-600 dark:text-gray-400 font-medium">{{ pick.position }}.</span>
                    <span class="text-gray-800 dark:text-gray-200">#{{ pick.rider_number }} {{ pick.rider_name }}</span>
                  </div>
                  {% endfor %}
                </div>
              </div>
              {% endif %}
            </div>
          {% else %}
            <div class="text-center py-8">
              <div class="text-4xl mb-4">🔒</div>
              <h3 class="text-lg font-semibold text-gray-700 dark:text-gray-300 mb-2">Picks dolda</h3>
              <p class="text-gray-600 dark:text-gray-400">
                Picks visas efter deadline för att förhindra tjuvkikning.
              </p>
            </div>
          {% endif %}
          
          <!-- Show deadline status -->
          {% if picks_locked %}
            <div class="mt-4 p-3 bg-red-100 dark:bg-red-900 rounded-lg">
              <p class="text-sm text-red-700 dark:text-red-300">
                🔒 <strong>Picks låsta!</strong> Andra användares picks visas nu.
              </p>
            </div>
          {% else %}
            <div class="mt-4 p-3 bg-blue-100 dark:bg-blue-900 rounded-lg">
              <p class="text-sm text-blue-700 dark:text-blue-300">
                ⏰ <strong>Picks öppna.</strong> Andra användares picks är dolda tills deadline.
              </p>
            </div>
          {% endif %}
        </div>
      </div>
      {% endif %}
    </div>
  </div>

  <!-- Navigation Sound -->
  <audio id="navSound" preload="auto">
    <source src="{{ url_for('static', filename='sfx/moto.mp3') }}" type="audio/mpeg">
  </audio>

  <script>
    // Navigation sound
    document.addEventListener('DOMContentLoaded', function() {
      const navSound = document.getElementById('navSound');
      const navLinks = document.querySelectorAll('.nav-sound');
      
      navLinks.forEach(link => {
        link.addEventListener('click', function() {
          if (navSound) {
            navSound.currentTime = 0;
            navSound.play().catch(e => console.log('Could not play sound:', e));
          }
        });
      });
    });
  </script>
</body>
</html>
