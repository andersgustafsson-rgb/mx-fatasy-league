<!DOCTYPE html>
<html lang="sv">
<head>
  <meta charset="UTF-8">
  <title>{{ target_user.username }} - Race Resultat - MX Fantasy League</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&family=Rajdhani:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  <style>
    body {
      font-family: 'Rajdhani', sans-serif;
      background: linear-gradient(135deg, #0f172a 0%, #1e293b 50%, #334155 100%);
      background-attachment: fixed;
    }
    
    .cyberpunk-header {
      font-family: 'Orbitron', monospace;
      text-shadow: 0 0 10px rgba(34, 211, 238, 0.8);
    }
    
    .cyberpunk-card {
      background: linear-gradient(135deg, #1e293b 0%, #334155 100%);
      border: 2px solid #22d3ee;
      box-shadow: 0 0 20px rgba(34, 211, 238, 0.3);
      transition: all 0.3s ease;
    }
    
    .cyberpunk-card:hover {
      box-shadow: 0 0 30px rgba(34, 211, 238, 0.5);
      transform: translateY(-2px);
    }
    
    .neon-text {
      text-shadow: 0 0 10px rgba(34, 211, 238, 0.8);
    }
    
    .cyberpunk-button {
      background: linear-gradient(45deg, #22d3ee, #06b6d4);
      border: 1px solid #22d3ee;
      box-shadow: 0 0 15px rgba(34, 211, 238, 0.4);
      transition: all 0.3s ease;
    }
    
    .cyberpunk-button:hover {
      box-shadow: 0 0 25px rgba(34, 211, 238, 0.6);
      transform: translateY(-1px);
    }
    
    .race-result-card {
      background: linear-gradient(135deg, #1e293b 0%, #334155 100%);
      border: 1px solid #475569;
      transition: all 0.3s ease;
    }
    
    .race-result-card:hover {
      border-color: #22d3ee;
      box-shadow: 0 0 20px rgba(34, 211, 238, 0.3);
      transform: translateY(-2px);
    }
    
    .floating-animation {
      animation: float 3s ease-in-out infinite;
    }
    
    @keyframes float {
      0%, 100% { transform: translateY(0px); }
      50% { transform: translateY(-10px); }
    }
    
    .pulse-glow {
      animation: pulse-glow 2s ease-in-out infinite;
    }
    
    @keyframes pulse-glow {
      0%, 100% { box-shadow: 0 0 20px rgba(34, 211, 238, 0.3); }
      50% { box-shadow: 0 0 30px rgba(34, 211, 238, 0.6); }
    }
  </style>
</head>
<body class="text-gray-100 min-h-screen">
  <div class="container mx-auto p-4 sm:p-6 md:p-8">
    <!-- Header -->
    <div class="flex flex-col sm:flex-row sm:justify-between sm:items-center mb-8 gap-6">
      <header class="text-center sm:text-left">
        <h1 class="cyberpunk-header text-4xl sm:text-5xl md:text-6xl font-bold text-cyan-400 mb-2">
          üèÅ {{ target_user.username }} - Race Resultat
        </h1>
        <div class="flex items-center justify-center sm:justify-start gap-2">
          <div class="w-3 h-3 bg-cyan-400 rounded-full pulse-glow"></div>
          <p class="text-lg sm:text-xl text-cyan-300 font-medium">
            Totalt: <span class="text-cyan-400 font-bold text-2xl">{{ total_points }} po√§ng</span>
          </p>
        </div>
        {% if season_team %}
        <p class="text-cyan-300 mt-2">
          Team: <span class="text-cyan-400 font-semibold">{{ season_team.team_name }}</span>
        </p>
        {% endif %}
      </header>
      <a href="{{ url_for('index') }}"
         class="cyberpunk-button text-white font-bold py-3 px-6 rounded-lg text-lg self-center floating-animation">
         ‚ö° Tillbaka till Huvudsidan
      </a>
    </div>

    {% with messages = get_flashed_messages(with_categories=true) %}
      {% if messages %}
        {% for category, message in messages %}
          <div class="cyberpunk-card p-4 sm:p-6 rounded-lg mb-6 text-center {{ 'border-green-400 bg-green-900/20' if category == 'success' else 'border-red-400 bg-red-900/20' }} text-white text-lg font-medium">
            <div class="flex items-center justify-center gap-3">
              <div class="text-2xl">{{ '‚úÖ' if category == 'success' else '‚ùå' }}</div>
              <span class="neon-text">{{ message }}</span>
            </div>
          </div>
        {% endfor %}
      {% endif %}
    {% endwith %}

    <!-- Race Results -->
    <div class="cyberpunk-card p-6 sm:p-8 rounded-xl">
      <div class="flex items-center gap-3 mb-6">
        <div class="text-3xl">üèÜ</div>
        <h2 class="text-2xl sm:text-3xl font-bold text-cyan-400 neon-text">Race Resultat</h2>
      </div>
      
      {% if race_results %}
        <div class="space-y-4">
          {% for result in race_results %}
            <div class="race-result-item race-result-card p-5 rounded-lg {% if loop.index > 15 %}hidden{% endif %}">
              <div class="flex flex-col sm:flex-row sm:justify-between sm:items-center gap-4">
                <div class="flex-1">
                  <div class="flex items-center gap-3 mb-2">
                    <h3 class="text-xl sm:text-2xl font-bold text-white">
                      {{ result.competition.name }}
                    </h3>
                    {% if result.has_results %}
                      <span class="inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-200">
                        ‚úÖ K√∂rt
                      </span>
                    {% else %}
                      <span class="inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-yellow-100 text-yellow-800 dark:bg-yellow-900 dark:text-yellow-200">
                        ‚è≥ V√§ntar
                      </span>
                    {% endif %}
                  </div>
                  <p class="text-cyan-300 text-sm">
                    {{ result.competition.event_date.strftime('%Y-%m-%d') if result.competition.event_date else 'Datum ej satt' }}
                  </p>
                </div>
                
                <div class="flex flex-col sm:flex-row gap-4 sm:gap-6">
                  <!-- Race Points -->
                  <div class="text-center">
                    <div class="text-2xl sm:text-3xl font-bold text-cyan-400">{{ result.race_points }}</div>
                    <div class="text-xs sm:text-sm text-cyan-300">Race Po√§ng</div>
                  </div>
                  
                  <!-- Holeshot Points -->
                  <div class="text-center">
                    <div class="text-2xl sm:text-3xl font-bold text-yellow-400">{{ result.holeshot_points }}</div>
                    <div class="text-xs sm:text-sm text-yellow-300">Holeshot</div>
                  </div>
                  
                  {% if result.competition.series != 'WSX' %}
                  <!-- Wildcard Points -->
                  <div class="text-center">
                    <div class="text-2xl sm:text-3xl font-bold text-purple-400">{{ result.wildcard_points }}</div>
                    <div class="text-xs sm:text-sm text-purple-300">Wildcard</div>
                  </div>
                  {% endif %}
                  
                  <!-- Total Points -->
                  <div class="text-center border-l-2 border-cyan-400 pl-4">
                    <div class="text-3xl sm:text-4xl font-bold 
                               {% if result.has_results and result.points > 0 %} text-green-400 neon-text
                               {% elif result.has_results and result.points == 0 %} text-red-400
                               {% else %} text-gray-400 {% endif %}">{{ result.points }}</div>
                    <div class="text-sm 
                               {% if result.has_results and result.points > 0 %} text-green-300
                               {% elif result.has_results and result.points == 0 %} text-red-300
                               {% else %} text-gray-300 {% endif %} font-semibold">Totalt</div>
                  </div>
                </div>
              </div>
            </div>
          {% endfor %}
        </div>
        
        {% if race_results|length > 15 %}
        <div class="mt-6 text-center">
          <button id="expand-race-results-btn" 
                  onclick="toggleRaceResults()"
                  class="cyberpunk-button text-white font-bold py-3 px-8 rounded-lg text-lg">
            üìã Visa fler ({{ race_results|length - 15 }} till)
          </button>
        </div>
        {% endif %}
      {% else %}
        <div class="text-center py-12">
          <div class="text-6xl mb-4 floating-animation">üèÅ</div>
          <p class="text-xl text-cyan-300 font-medium mb-2">Inga race-resultat √§n</p>
          <p class="text-cyan-400">Denna anv√§ndare har inte deltagit i n√•gra t√§vlingar √§n.</p>
        </div>
      {% endif %}
    </div>

    <!-- Stats Summary -->
    {% if race_results %}
    <div class="cyberpunk-card p-6 sm:p-8 rounded-xl mt-8">
      <div class="flex items-center gap-3 mb-6">
        <div class="text-3xl">üìä</div>
        <h2 class="text-2xl sm:text-3xl font-bold text-cyan-400 neon-text">Statistik</h2>
      </div>
      
      <div class="grid grid-cols-2 sm:grid-cols-4 gap-6">
        <div class="text-center">
          <div class="text-3xl sm:text-4xl font-bold text-cyan-400">{{ race_results|length }}</div>
          <div class="text-sm text-cyan-300">T√§vlingar</div>
        </div>
        
        <div class="text-center">
          <div class="text-3xl sm:text-4xl font-bold text-green-400">{{ total_points }}</div>
          <div class="text-sm text-green-300">Total Po√§ng</div>
        </div>
        
        <div class="text-center">
          <div class="text-3xl sm:text-4xl font-bold text-yellow-400">
            {{ (race_results | sum(attribute='holeshot_points')) }}
          </div>
          <div class="text-sm text-yellow-300">Holeshot Po√§ng</div>
        </div>
        
        {% if race_results | selectattr('competition.series', 'ne', 'WSX') | list | length > 0 %}
        <div class="text-center">
          <div class="text-3xl sm:text-4xl font-bold text-purple-400">
            {{ (race_results | selectattr('competition.series', 'ne', 'WSX') | sum(attribute='wildcard_points')) }}
          </div>
          <div class="text-sm text-purple-300">Wildcard Po√§ng</div>
        </div>
        {% endif %}
      </div>
    </div>
    {% endif %}
  </div>
  
  <script>
    // Expand/collapse race results
    let raceResultsExpanded = false;
    function toggleRaceResults() {
      const items = document.querySelectorAll('.race-result-item');
      const btn = document.getElementById('expand-race-results-btn');
      const totalHidden = items.length - 15;
      
      if (!raceResultsExpanded) {
        // Show all
        items.forEach(item => item.classList.remove('hidden'));
        btn.textContent = `üìã Visa f√§rre (visar alla ${items.length})`;
        raceResultsExpanded = true;
      } else {
        // Show only first 15
        items.forEach((item, index) => {
          if (index >= 15) {
            item.classList.add('hidden');
          }
        });
        btn.textContent = `üìã Visa fler (${totalHidden} till)`;
        raceResultsExpanded = false;
      }
    }
  </script>
</body>
</html>
