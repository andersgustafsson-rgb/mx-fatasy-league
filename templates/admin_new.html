<!DOCTYPE html>
<html lang="sv">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Panel - Mitt Fantasy Spel</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        .tab-btn {
            @apply px-4 py-2 text-sm font-medium text-gray-600 hover:text-gray-800 border-b-2 border-transparent hover:border-gray-300 transition-colors;
        }
        .tab-btn.active {
            @apply text-blue-600 border-blue-600;
        }
        .tab-panel {
            @apply hidden;
        }
        .tab-panel.active {
            @apply block;
        }
    </style>
</head>
<body class="bg-gray-50 min-h-screen">
    <div class="container mx-auto px-4 py-8">
        <!-- Header -->
        <div class="bg-white rounded-lg shadow-sm p-6 mb-6">
            <h1 class="text-3xl font-bold text-gray-900 mb-2">Admin Panel</h1>
            <p class="text-gray-600">Hantera t√§vlingar, anv√§ndare och systeminst√§llningar</p>
        </div>

        <!-- Tab Navigation -->
        <div class="bg-white rounded-lg shadow-sm mb-6">
            <div class="border-b border-gray-200">
                <nav class="flex space-x-8 px-6">
                    <button class="tab-btn active" data-tab="race-management">
                        üèÅ Race Management
                    </button>
                    <button class="tab-btn" data-tab="user-management">
                        üë• Anv√§ndare
                    </button>
                    <button class="tab-btn" data-tab="system-tools">
                        üîß Systemverktyg
                    </button>
                    <button class="tab-btn" data-tab="countdown-test">
                        ‚è∞ Countdown Test
                    </button>
                </nav>
            </div>
        </div>

        <!-- Tab Panels -->
        <div class="space-y-6">
            <!-- Race Management Tab -->
            <div id="race-management" class="tab-panel active">
                <div class="bg-white rounded-lg shadow-sm p-6">
                    <h2 class="text-xl font-semibold text-gray-900 mb-4">üèÅ Race Management</h2>
                    
                    <!-- Simulate Race Section -->
                    <div class="mb-8">
                        <h3 class="text-lg font-medium text-gray-800 mb-3">Simulera Race</h3>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">V√§lj Race:</label>
                                <select id="raceSelect" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                                    <option value="">V√§lj ett race att simulera...</option>
                                </select>
                            </div>
                            <div class="flex items-end">
                                <button id="simulateBtn" class="w-full bg-blue-600 text-white px-4 py-2 rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500">
                                    Simulera Race
                                </button>
                            </div>
                        </div>
                    </div>

                    <!-- Race Picks Section -->
                    <div class="mb-8">
                        <h3 class="text-lg font-medium text-gray-800 mb-3">Race Picks</h3>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">450cc Picks:</label>
                                <div id="picks450" class="space-y-2">
                                    <!-- 450cc picks will be populated here -->
                                </div>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">250cc Picks:</label>
                                <div id="picks250" class="space-y-2">
                                    <!-- 250cc picks will be populated here -->
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Holeshot Picks Section -->
                    <div class="mb-8">
                        <h3 class="text-lg font-medium text-gray-800 mb-3">Holeshot Picks</h3>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">450cc Holeshot:</label>
                                <select id="holeshot450" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                                    <option value="">V√§lj 450cc holeshot...</option>
                                </select>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">250cc Holeshot:</label>
                                <select id="holeshot250" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                                    <option value="">V√§lj 250cc holeshot...</option>
                                </select>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- User Management Tab -->
            <div id="user-management" class="tab-panel">
                <div class="bg-white rounded-lg shadow-sm p-6">
                    <h2 class="text-xl font-semibold text-gray-900 mb-4">üë• Anv√§ndarhantering</h2>
                    
                    <div class="space-y-4">
                        <a href="/admin/users" class="inline-block bg-green-600 text-white px-4 py-2 rounded-md hover:bg-green-700">
                            Visa alla anv√§ndare
                        </a>
                        <a href="/cleanup_duplicate_users" class="inline-block bg-yellow-600 text-white px-4 py-2 rounded-md hover:bg-yellow-700">
                            Rensa duplicerade anv√§ndare
                        </a>
                        <a href="/admin_old" class="inline-block bg-gray-600 text-white px-4 py-2 rounded-md hover:bg-gray-700">
                            G√• till gamla admin-sidan
                        </a>
                    </div>
                </div>
            </div>

            <!-- System Tools Tab -->
            <div id="system-tools" class="tab-panel">
                <div class="bg-white rounded-lg shadow-sm p-6">
                    <h2 class="text-xl font-semibold text-gray-900 mb-4">üîß Systemverktyg</h2>
                    
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div class="space-y-3">
                            <h3 class="text-lg font-medium text-gray-800">Rider Data</h3>
                            <a href="/fix_existing_riders" class="block bg-blue-600 text-white px-4 py-2 rounded-md hover:bg-blue-700 text-center">
                                Fixa rider data
                            </a>
                            <a href="/fix_rider_coasts" class="block bg-purple-600 text-white px-4 py-2 rounded-md hover:bg-purple-700 text-center">
                                Fixa rider coasts
                            </a>
                            <a href="/debug_rider_coasts" class="block bg-gray-600 text-white px-4 py-2 rounded-md hover:bg-gray-700 text-center">
                                Debug rider coasts
                            </a>
                        </div>
                        
                        <div class="space-y-3">
                            <h3 class="text-lg font-medium text-gray-800">Database</h3>
                            <a href="/fix_bulletin_columns" class="block bg-green-600 text-white px-4 py-2 rounded-md hover:bg-green-700 text-center">
                                Fixa bulletin kolumner
                            </a>
                            <a href="/create_admin" class="block bg-red-600 text-white px-4 py-2 rounded-md hover:bg-red-700 text-center">
                                Skapa admin anv√§ndare
                            </a>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Countdown Test Tab -->
            <div id="countdown-test" class="tab-panel">
                <div class="bg-white rounded-lg shadow-sm p-6">
                    <h2 class="text-xl font-semibold text-gray-900 mb-4">‚è∞ Countdown Test</h2>
                    
                    <div class="space-y-4">
                        <a href="/test_countdown_page" class="inline-block bg-blue-600 text-white px-4 py-2 rounded-md hover:bg-blue-700">
                            Testa Countdown Scenarios
                        </a>
                        
                        <div class="mt-6 p-4 bg-gray-50 rounded-lg">
                            <h3 class="text-lg font-medium text-gray-800 mb-2">Snabb Test</h3>
                            <div class="grid grid-cols-2 md:grid-cols-4 gap-2">
                                <button onclick="testScenario('race_in_3h')" class="bg-blue-500 text-white px-3 py-2 rounded text-sm hover:bg-blue-600">
                                    3h till race
                                </button>
                                <button onclick="testScenario('race_in_1h')" class="bg-orange-500 text-white px-3 py-2 rounded text-sm hover:bg-orange-600">
                                    1h till race
                                </button>
                                <button onclick="testScenario('race_in_30m')" class="bg-red-500 text-white px-3 py-2 rounded text-sm hover:bg-red-600">
                                    30m till race
                                </button>
                                <button onclick="testScenario('race_tomorrow')" class="bg-green-500 text-white px-3 py-2 rounded text-sm hover:bg-green-600">
                                    Imorgon
                                </button>
                            </div>
                            <button onclick="resetToRealTime()" class="mt-3 bg-gray-500 text-white px-4 py-2 rounded hover:bg-gray-600">
                                √Öterst√§ll till riktig tid
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Tab functionality
        function initTabs() {
            const tabBtns = document.querySelectorAll('.tab-btn');
            const tabPanels = document.querySelectorAll('.tab-panel');

            tabBtns.forEach(btn => {
                btn.addEventListener('click', () => {
                    const targetTab = btn.getAttribute('data-tab');
                    
                    // Remove active class from all tabs and panels
                    tabBtns.forEach(b => b.classList.remove('active'));
                    tabPanels.forEach(p => p.classList.remove('active'));
                    
                    // Add active class to clicked tab and corresponding panel
                    btn.classList.add('active');
                    document.getElementById(targetTab).classList.add('active');
                });
            });
        }

        // Initialize tabs when page loads
        document.addEventListener('DOMContentLoaded', () => {
            initTabs();
            loadRaces();
            loadRiders();
        });

        // Load races for simulation
        async function loadRaces() {
            try {
                const response = await fetch('/api/races');
                const races = await response.json();
                
                const select = document.getElementById('raceSelect');
                select.innerHTML = '<option value="">V√§lj ett race att simulera...</option>';
                
                races.forEach(race => {
                    const option = document.createElement('option');
                    option.value = race.id;
                    option.textContent = `${race.name} - ${race.date}`;
                    select.appendChild(option);
                });
            } catch (error) {
                console.error('Error loading races:', error);
            }
        }

        // Load riders for picks
        async function loadRiders() {
            try {
                const response = await fetch('/api/riders');
                const riders = await response.json();
                
                // Populate 450cc picks
                const picks450 = document.getElementById('picks450');
                for (let i = 1; i <= 5; i++) {
                    const div = document.createElement('div');
                    div.innerHTML = `
                        <select class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                            <option value="">Pick ${i}...</option>
                            ${riders.filter(r => r.class === '450').map(r => 
                                `<option value="${r.id}">${r.name} #${r.number}</option>`
                            ).join('')}
                        </select>
                    `;
                    picks450.appendChild(div);
                }

                // Populate 250cc picks
                const picks250 = document.getElementById('picks250');
                for (let i = 1; i <= 5; i++) {
                    const div = document.createElement('div');
                    div.innerHTML = `
                        <select class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                            <option value="">Pick ${i}...</option>
                            ${riders.filter(r => r.class === '250').map(r => 
                                `<option value="${r.id}">${r.name} #${r.number}</option>`
                            ).join('')}
                        </select>
                    `;
                    picks250.appendChild(div);
                }

                // Populate holeshot dropdowns
                const holeshot450 = document.getElementById('holeshot450');
                holeshot450.innerHTML = '<option value="">V√§lj 450cc holeshot...</option>';
                riders.filter(r => r.class === '450').forEach(r => {
                    const option = document.createElement('option');
                    option.value = r.id;
                    option.textContent = `${r.name} #${r.number}`;
                    holeshot450.appendChild(option);
                });

                const holeshot250 = document.getElementById('holeshot250');
                holeshot250.innerHTML = '<option value="">V√§lj 250cc holeshot...</option>';
                riders.filter(r => r.class === '250').forEach(r => {
                    const option = document.createElement('option');
                    option.value = r.id;
                    option.textContent = `${r.name} #${r.number}`;
                    holeshot250.appendChild(option);
                });

            } catch (error) {
                console.error('Error loading riders:', error);
            }
        }

        // Simulate race
        document.getElementById('simulateBtn').addEventListener('click', async () => {
            const raceId = document.getElementById('raceSelect').value;
            if (!raceId) {
                alert('V√§lj ett race f√∂rst!');
                return;
            }

            try {
                const response = await fetch(`/simulate_race/${raceId}`, {
                    method: 'POST'
                });
                
                if (response.ok) {
                    alert('Race simulerat framg√•ngsrikt!');
                } else {
                    alert('Fel vid simulering av race');
                }
            } catch (error) {
                console.error('Error simulating race:', error);
                alert('Fel vid simulering av race');
            }
        });

        // Countdown test functions
        async function testScenario(scenario) {
            try {
                const response = await fetch('/test_countdown', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ scenario })
                });
                
                const result = await response.json();
                if (result.success) {
                    alert(`Scenario "${scenario}" aktiverat!`);
                } else {
                    alert('Fel vid aktivering av scenario');
                }
            } catch (error) {
                console.error('Error testing scenario:', error);
                alert('Fel vid testning av scenario');
            }
        }

        async function resetToRealTime() {
            try {
                const response = await fetch('/reset_simulation', {
                    method: 'POST'
                });
                
                if (response.ok) {
                    alert('√Öterst√§llt till riktig tid!');
                } else {
                    alert('Fel vid √•terst√§llning');
                }
            } catch (error) {
                console.error('Error resetting time:', error);
                alert('Fel vid √•terst√§llning');
            }
        }
    </script>
</body>
</html>
