<!DOCTYPE html>
<html lang="sv">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Motocross Quiz - MX Fantasy League</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&family=Rajdhani:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Rajdhani', sans-serif;
            background: linear-gradient(135deg, #0f172a 0%, #1e293b 50%, #334155 100%);
            background-attachment: fixed;
        }
        
        .cyberpunk-header {
            font-family: 'Orbitron', monospace;
            text-shadow: 0 0 10px rgba(34, 211, 238, 0.8);
        }
        
        .quiz-card {
            background: linear-gradient(135deg, #1e293b 0%, #334155 100%);
            border: 2px solid #22d3ee;
            box-shadow: 0 0 20px rgba(34, 211, 238, 0.3);
        }
        
        .btn-primary {
            background: linear-gradient(135deg, #22d3ee 0%, #06b6d4 100%);
            color: #0f172a;
            font-weight: 600;
            transition: all 0.3s ease;
        }
        .btn-primary:hover {
            background: linear-gradient(135deg, #06b6d4 0%, #0891b2 100%);
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(34, 211, 238, 0.4);
        }
        
        .btn-success {
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
            color: white;
            font-weight: 600;
        }
        .btn-success:hover {
            background: linear-gradient(135deg, #059669 0%, #047857 100%);
            transform: translateY(-2px);
        }
        
        .btn-danger {
            background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
            color: white;
            font-weight: 600;
        }
        .btn-danger:hover {
            background: linear-gradient(135deg, #dc2626 0%, #b91c1c 100%);
            transform: translateY(-2px);
        }
        
        .option-btn {
            transition: all 0.3s ease;
            border: 2px solid transparent;
        }
        .option-btn:hover {
            border-color: #22d3ee;
            box-shadow: 0 0 10px rgba(34, 211, 238, 0.3);
        }
        .option-btn.selected {
            border-color: #22d3ee;
            background: linear-gradient(135deg, #1e293b 0%, #334155 100%);
            box-shadow: 0 0 15px rgba(34, 211, 238, 0.5);
        }
        .option-btn.correct {
            border-color: #10b981;
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
            color: white;
        }
        .option-btn.incorrect {
            border-color: #ef4444;
            background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
            color: white;
        }
        
        .progress-bar {
            background: linear-gradient(90deg, #22d3ee 0%, #06b6d4 100%);
            transition: width 0.5s ease;
        }
        
        .pulse-animation {
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }
    </style>
</head>
<body class="min-h-screen">
    <div class="container mx-auto px-4 py-8">
        <!-- Header -->
        <div class="text-center mb-8">
            <h1 class="cyberpunk-header text-4xl font-bold text-cyan-400 mb-2">üèÅ MOTOCROSS QUIZ</h1>
            <p class="text-gray-300 text-lg">Testa dina kunskaper om Motocross!</p>
        </div>

        <!-- Game Container -->
        <div id="game-container" class="max-w-4xl mx-auto">
            <!-- Start Screen -->
            <div id="start-screen" class="quiz-card rounded-lg p-8 text-center">
                <h2 class="text-3xl font-bold text-cyan-400 mb-6">V√§lkommen till Motocross Quiz!</h2>
                <p class="text-gray-300 text-lg mb-8">Svara p√• 10 slumpm√§ssiga fr√•gor om Motocross och se hur bra du √§r!</p>
                
                <div class="mb-6">
                    <label class="block text-sm font-medium text-gray-300 mb-2">V√§lj sv√•righetsgrad:</label>
                    <select id="difficulty-select" class="px-4 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white focus:border-cyan-400">
                        <option value="easy">L√§tt - Nyb√∂rjare</option>
                        <option value="medium" selected>Medium - Erfaren</option>
                        <option value="hard">Sv√•r - Expert</option>
                    </select>
                </div>
                
                <button onclick="startQuiz()" class="btn-primary px-8 py-4 rounded-lg text-xl">
                    üöÄ Starta Quiz!
                </button>
            </div>

            <!-- Quiz Screen -->
            <div id="quiz-screen" class="quiz-card rounded-lg p-8 hidden">
                <!-- Progress Bar -->
                <div class="mb-6">
                    <div class="flex justify-between items-center mb-2">
                        <span class="text-sm font-medium text-gray-300">Fr√•ga <span id="current-question">1</span> av <span id="total-questions">10</span></span>
                        <span class="text-sm font-medium text-cyan-400">Po√§ng: <span id="current-score">0</span></span>
                    </div>
                    <div class="w-full bg-gray-700 rounded-full h-3">
                        <div id="progress-bar" class="progress-bar h-3 rounded-full" style="width: 0%"></div>
                    </div>
                </div>

                <!-- Question -->
                <div class="mb-8">
                    <h3 id="question-text" class="text-2xl font-bold text-white mb-6 text-center"></h3>
                    <div id="question-image" class="mb-6 text-center hidden">
                        <img id="question-img" src="" alt="Question image" class="max-w-md mx-auto rounded-lg shadow-lg">
                    </div>
                </div>

                <!-- Options -->
                <div id="options-container" class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-8">
                    <!-- Options will be generated here -->
                </div>

                <!-- Action Buttons -->
                <div class="flex justify-center gap-4">
                    <button id="submit-btn" onclick="submitAnswer()" class="btn-primary px-6 py-3 rounded-lg" disabled>
                        ‚úÖ Svara
                    </button>
                    <button id="next-btn" onclick="nextQuestion()" class="btn-success px-6 py-3 rounded-lg hidden">
                        ‚û°Ô∏è N√§sta
                    </button>
                </div>
            </div>

            <!-- Results Screen -->
            <div id="results-screen" class="quiz-card rounded-lg p-8 text-center hidden">
                <h2 class="text-3xl font-bold text-cyan-400 mb-6">üéâ Quiz Klart!</h2>
                <div class="mb-8">
                    <div class="text-6xl mb-4">
                        <span id="result-emoji">üèÜ</span>
                    </div>
                    <p class="text-2xl font-bold text-white mb-2">Du fick <span id="final-score">0</span> av 10 r√§tt!</p>
                    <p id="result-message" class="text-lg text-gray-300"></p>
                </div>
                
                <div class="flex justify-center gap-4">
                    <button onclick="playAgain()" class="btn-primary px-6 py-3 rounded-lg">
                        üîÑ Spela igen
                    </button>
                    <button onclick="showHighScores()" class="btn-warning px-6 py-3 rounded-lg">
                        üèÜ Highscores
                    </button>
                    <button onclick="goHome()" class="btn-success px-6 py-3 rounded-lg">
                        üè† Tillbaka till startsidan
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Current player (display name > username), injected from server
        window.currentPlayerName = {{ (current_player_name or 'null')|tojson }};
        if (window.currentPlayerName) {
            try { localStorage.setItem('currentPlayerName', window.currentPlayerName); } catch (e) {}
        }
        // Quiz data
        const quizData = {
            easy: [
                {
                    question: "Vilken f√§rg har vanligtvis en Yamaha motorcykel?",
                    options: ["R√∂d", "Bl√•", "Gr√∂n", "Gul"],
                    correct: 1,
                    explanation: "Yamaha anv√§nder traditionellt bl√• f√§rger f√∂r sina motorcyklar."
                },
                {
                    question: "Hur m√•nga hjul har en motocross-motorcykel?",
                    options: ["Ett", "Tv√•", "Tre", "Fyra"],
                    correct: 1,
                    explanation: "En motocross-motorcykel har tv√• hjul, precis som en vanlig motorcykel."
                },
                {
                    question: "Vad kallas den f√∂rsta kurvan i en motocross-bana?",
                    options: ["Start", "Holeshot", "Finish", "Jump"],
                    correct: 1,
                    explanation: "Holeshot √§r den f√∂rsta kurvan efter startlinjen."
                },
                {
                    question: "Vilken klass k√∂rs vanligtvis f√∂rst i en Supercross-t√§vling?",
                    options: ["450cc", "250cc", "125cc", "65cc"],
                    correct: 1,
                    explanation: "250cc-klassen k√∂rs vanligtvis f√∂rst, f√∂ljt av 450cc."
                },
                {
                    question: "Vad anv√§nder f√∂rare f√∂r att skydda huvudet?",
                    options: ["Hj√§lm", "Hatt", "Keps", "Ingenting"],
                    correct: 0,
                    explanation: "En hj√§lm √§r obligatorisk f√∂r att skydda huvudet."
                },
                {
                    question: "Vilken f√§rg har vanligtvis en Honda motorcykel?",
                    options: ["R√∂d", "Bl√•", "Gr√∂n", "Gul"],
                    correct: 0,
                    explanation: "Honda anv√§nder traditionellt r√∂da f√§rger f√∂r sina motorcyklar."
                },
                {
                    question: "Vad kallas en motorcykel som √§r designad f√∂r terr√§ngk√∂rning?",
                    options: ["Road bike", "Motocross", "Scooter", "Chopper"],
                    correct: 1,
                    explanation: "Motocross √§r en motorcykel designad f√∂r terr√§ngk√∂rning."
                },
                {
                    question: "Hur m√•nga cylindrar har en typisk 450cc motorcykel?",
                    options: ["En", "Tv√•", "Tre", "Fyra"],
                    correct: 0,
                    explanation: "En typisk 450cc motorcykel har en cylinder."
                },
                {
                    question: "Vad kallas det n√§r en f√∂rare hoppar √∂ver en hoppramp?",
                    options: ["Jump", "Leap", "Bounce", "Spring"],
                    correct: 0,
                    explanation: "Jump √§r det korrekta ordet f√∂r att hoppa √∂ver en hoppramp."
                },
                {
                    question: "Vilken del av motorcykeln anv√§nds f√∂r att bromsa?",
                    options: ["Handtag", "Broms", "Pedal", "Kedja"],
                    correct: 1,
                    explanation: "Broms anv√§nds f√∂r att stoppa motorcykeln."
                },
                {
                    question: "Vad kallas det n√§r en f√∂rare k√∂r genom vatten?",
                    options: ["Swim", "Splash", "Water crossing", "Dive"],
                    correct: 2,
                    explanation: "Water crossing √§r det korrekta ordet f√∂r att k√∂ra genom vatten."
                },
                {
                    question: "Vilken f√§rg har vanligtvis en KTM motorcykel?",
                    options: ["R√∂d", "Bl√•", "Orange", "Gul"],
                    correct: 2,
                    explanation: "KTM anv√§nder traditionellt orange f√§rger f√∂r sina motorcyklar."
                },
                {
                    question: "Vad kallas det n√§r en f√∂rare k√∂r genom sand?",
                    options: ["Sand riding", "Beach crossing", "Desert racing", "Dune jumping"],
                    correct: 0,
                    explanation: "Sand riding √§r det korrekta ordet f√∂r att k√∂ra genom sand."
                },
                {
                    question: "Vad kallas det n√§r en f√∂rare k√∂r genom lera?",
                    options: ["Mud riding", "Clay crossing", "Dirt racing", "Wet riding"],
                    correct: 0,
                    explanation: "Mud riding √§r det korrekta ordet f√∂r att k√∂ra genom lera."
                }
            ],
            medium: [
                {
                    question: "Vilken f√∂rare vann 2023 Supercross 450cc m√§sterskapet?",
                    options: ["Eli Tomac", "Cooper Webb", "Chase Sexton", "Jason Anderson"],
                    correct: 2,
                    explanation: "Chase Sexton vann 2023 Supercross 450cc m√§sterskapet."
                },
                {
                    question: "Hur m√•nga rundor k√∂rs vanligtvis i en Supercross heat?",
                    options: ["5-6", "8-10", "12-15", "20+"],
                    correct: 1,
                    explanation: "En Supercross heat √§r vanligtvis 8-10 rundor l√•ng."
                },
                {
                    question: "Vilken bana √§r k√§nd som 'The Monster'?",
                    options: ["Anaheim", "Daytona", "Las Vegas", "Salt Lake City"],
                    correct: 0,
                    explanation: "Anaheim Stadium √§r k√§nd som 'The Monster' i Supercross-v√§rlden."
                },
                {
                    question: "Vad kallas en hoppramp som g√•r b√•de upp och ner?",
                    options: ["Tabletop", "Double", "Triple", "Whoops"],
                    correct: 0,
                    explanation: "En tabletop √§r en hoppramp med platt topp som g√•r b√•de upp och ner."
                },
                {
                    question: "Vilken f√∂rare har flest Supercross 450cc titlar?",
                    options: ["Ricky Carmichael", "Jeremy McGrath", "Ryan Dungey", "Eli Tomac"],
                    correct: 1,
                    explanation: "Jeremy McGrath har 7 Supercross 450cc titlar, flest n√•gonsin."
                },
                {
                    question: "Vilken f√∂rare vann 2024 Supercross 250cc East Coast m√§sterskapet?",
                    options: ["Jett Lawrence", "Levi Kitchen", "RJ Hampshire", "Cameron McAdoo"],
                    correct: 0,
                    explanation: "Jett Lawrence vann 2024 Supercross 250cc East Coast m√§sterskapet."
                },
                {
                    question: "Vilken bana √§r k√§nd f√∂r sin 'Sand Section'?",
                    options: ["Anaheim", "Daytona", "Las Vegas", "Salt Lake City"],
                    correct: 1,
                    explanation: "Daytona √§r k√§nd f√∂r sin utmanande sandsektion."
                },
                {
                    question: "Hur m√•nga f√∂rare kvalificerar sig f√∂r Supercross huvudt√§vlingen?",
                    options: ["20", "22", "24", "26"],
                    correct: 1,
                    explanation: "22 f√∂rare kvalificerar sig f√∂r Supercross huvudt√§vlingen."
                },
                {
                    question: "Vilken f√∂rare kallas 'The GOAT' (Greatest Of All Time)?",
                    options: ["Ricky Carmichael", "Jeremy McGrath", "Ryan Dungey", "Eli Tomac"],
                    correct: 0,
                    explanation: "Ricky Carmichael kallas 'The GOAT' f√∂r sina 15 AMA m√§sterskap."
                },
                {
                    question: "Vad kallas en serie av sm√• hopprampar?",
                    options: ["Tabletop", "Double", "Triple", "Whoops"],
                    correct: 3,
                    explanation: "Whoops √§r en serie av sm√• hopprampar som kr√§ver snabb teknik."
                },
                {
                    question: "Vilken f√∂rare vann 2022 Supercross 450cc m√§sterskapet?",
                    options: ["Eli Tomac", "Cooper Webb", "Chase Sexton", "Jason Anderson"],
                    correct: 0,
                    explanation: "Eli Tomac vann 2022 Supercross 450cc m√§sterskapet."
                },
                {
                    question: "Vilken bana √§r k√§nd som 'The Big One'?",
                    options: ["Anaheim", "Daytona", "Las Vegas", "Salt Lake City"],
                    correct: 1,
                    explanation: "Daytona √§r k√§nd som 'The Big One' f√∂r sin enorma storlek."
                },
                {
                    question: "Vad kallas det n√§r en f√∂rare k√∂r genom en kurva?",
                    options: ["Cornering", "Turning", "Bending", "Curving"],
                    correct: 0,
                    explanation: "Cornering √§r det korrekta ordet f√∂r att k√∂ra genom en kurva."
                },
                {
                    question: "Vilken f√∂rare har flest AMA Motocross 450cc titlar?",
                    options: ["Ricky Carmichael", "Ryan Dungey", "Eli Tomac", "Jeremy McGrath"],
                    correct: 0,
                    explanation: "Ricky Carmichael har 5 AMA Motocross 450cc titlar, flest n√•gonsin."
                },
                {
                    question: "Vad kallas det n√§r en f√∂rare k√∂r genom en hoppramp?",
                    options: ["Jumping", "Leaping", "Bouncing", "Springing"],
                    correct: 0,
                    explanation: "Jumping √§r det korrekta ordet f√∂r att k√∂ra genom en hoppramp."
                },
                {
                    question: "Vilken f√∂rare vann 2021 Supercross 450cc m√§sterskapet?",
                    options: ["Eli Tomac", "Cooper Webb", "Chase Sexton", "Jason Anderson"],
                    correct: 1,
                    explanation: "Cooper Webb vann 2021 Supercross 450cc m√§sterskapet."
                },
                {
                    question: "Vilken bana √§r k√§nd f√∂r sin 'Triple Crown'?",
                    options: ["Anaheim", "Daytona", "Las Vegas", "Salt Lake City"],
                    correct: 0,
                    explanation: "Anaheim √§r k√§nd f√∂r sin 'Triple Crown' med tre separata t√§vlingar."
                },
                {
                    question: "Vad kallas det n√§r en f√∂rare k√∂r genom en kurva med h√∂g hastighet?",
                    options: ["Fast cornering", "Speed turning", "Quick bending", "Rapid curving"],
                    correct: 0,
                    explanation: "Fast cornering √§r det korrekta ordet f√∂r att k√∂ra genom en kurva med h√∂g hastighet."
                },
                {
                    question: "Vilken f√∂rare vann 2020 Supercross 450cc m√§sterskapet?",
                    options: ["Eli Tomac", "Cooper Webb", "Chase Sexton", "Jason Anderson"],
                    correct: 0,
                    explanation: "Eli Tomac vann 2020 Supercross 450cc m√§sterskapet."
                },
                {
                    question: "Vilken bana √§r k√§nd f√∂r sin 'Monster Energy' sponsring?",
                    options: ["Anaheim", "Daytona", "Las Vegas", "Salt Lake City"],
                    correct: 0,
                    explanation: "Anaheim √§r k√§nd f√∂r sin 'Monster Energy' sponsring."
                }
            ],
            hard: [
                {
                    question: "Vilken f√∂rare vann 2024 Supercross 250cc West Coast m√§sterskapet?",
                    options: ["Jett Lawrence", "Levi Kitchen", "RJ Hampshire", "Cameron McAdoo"],
                    correct: 1,
                    explanation: "Levi Kitchen vann 2024 Supercross 250cc West Coast m√§sterskapet."
                },
                {
                    question: "Vilken bana har den l√§ngsta straightaway i Supercross?",
                    options: ["Anaheim", "Daytona", "Las Vegas", "Salt Lake City"],
                    correct: 1,
                    explanation: "Daytona har den l√§ngsta straightaway i Supercross-serien."
                },
                {
                    question: "Vilken f√∂rare kallas 'The GOAT' (Greatest Of All Time)?",
                    options: ["Ricky Carmichael", "Jeremy McGrath", "Ryan Dungey", "Eli Tomac"],
                    correct: 0,
                    explanation: "Ricky Carmichael kallas 'The GOAT' f√∂r sina 15 AMA m√§sterskap."
                },
                {
                    question: "Vilken f√∂rare har flest AMA Motocross 450cc titlar?",
                    options: ["Ricky Carmichael", "Ryan Dungey", "Eli Tomac", "Jeremy McGrath"],
                    correct: 0,
                    explanation: "Ricky Carmichael har 5 AMA Motocross 450cc titlar, flest n√•gonsin."
                },
                {
                    question: "Vilken bana √§r k√§nd f√∂r sin 'Sand Section'?",
                    options: ["Anaheim", "Daytona", "Las Vegas", "Salt Lake City"],
                    correct: 1,
                    explanation: "Daytona √§r k√§nd f√∂r sin utmanande sandsektion."
                }
            ]
        };

        let currentQuiz = [];
        let currentQuestion = 0;
        let score = 0;
        let selectedAnswer = null;
        let answered = false;

        function startQuiz() {
            const difficulty = document.getElementById('difficulty-select').value;
            currentQuiz = [...quizData[difficulty]];
            
            // Shuffle questions and take 10 random ones
            currentQuiz = shuffleArray(currentQuiz).slice(0, 10);
            
            currentQuestion = 0;
            score = 0;
            selectedAnswer = null;
            answered = false;
            
            document.getElementById('start-screen').classList.add('hidden');
            document.getElementById('quiz-screen').classList.remove('hidden');
            document.getElementById('results-screen').classList.add('hidden');
            
            showQuestion();
        }

        function showQuestion() {
            const question = currentQuiz[currentQuestion];
            document.getElementById('question-text').textContent = question.question;
            document.getElementById('current-question').textContent = currentQuestion + 1;
            document.getElementById('current-score').textContent = score;
            
            // Update progress bar
            const progress = ((currentQuestion) / currentQuiz.length) * 100;
            document.getElementById('progress-bar').style.width = progress + '%';
            
            // Clear any existing explanation
            const existingExplanation = document.querySelector('.mt-4.p-4.bg-blue-900');
            if (existingExplanation) {
                existingExplanation.remove();
            }
            
            // Generate options
            const optionsContainer = document.getElementById('options-container');
            optionsContainer.innerHTML = '';
            
            question.options.forEach((option, index) => {
                const button = document.createElement('button');
                button.className = 'option-btn w-full p-4 text-left rounded-lg bg-gray-700 text-white hover:bg-gray-600 transition-all';
                button.textContent = option;
                button.onclick = () => selectAnswer(index);
                optionsContainer.appendChild(button);
            });
            
            // Reset buttons
            document.getElementById('submit-btn').disabled = true;
            document.getElementById('submit-btn').classList.remove('hidden');
            document.getElementById('next-btn').classList.add('hidden');
            selectedAnswer = null;
            answered = false;
        }

        function selectAnswer(index) {
            if (answered) return;
            
            // Remove previous selection
            document.querySelectorAll('.option-btn').forEach(btn => {
                btn.classList.remove('selected');
            });
            
            // Add selection to clicked button
            document.querySelectorAll('.option-btn')[index].classList.add('selected');
            selectedAnswer = index;
            document.getElementById('submit-btn').disabled = false;
        }

        function submitAnswer() {
            if (selectedAnswer === null || answered) return;
            
            answered = true;
            const question = currentQuiz[currentQuestion];
            const isCorrect = selectedAnswer === question.correct;
            
            if (isCorrect) {
                score++;
            }
            
            // Show correct/incorrect answers
            document.querySelectorAll('.option-btn').forEach((btn, index) => {
                btn.classList.remove('selected');
                if (index === question.correct) {
                    btn.classList.add('correct');
                } else if (index === selectedAnswer && !isCorrect) {
                    btn.classList.add('incorrect');
                }
            });
            
            // Show explanation directly on screen
            setTimeout(() => {
                showExplanation(question.explanation);
            }, 1000);
            
            // Show next button
            document.getElementById('submit-btn').classList.add('hidden');
            document.getElementById('next-btn').classList.remove('hidden');
        }

        function nextQuestion() {
            currentQuestion++;
            
            if (currentQuestion < currentQuiz.length) {
                showQuestion();
            } else {
                showResults();
            }
        }

        function showResults() {
            document.getElementById('quiz-screen').classList.add('hidden');
            document.getElementById('results-screen').classList.remove('hidden');
            
            document.getElementById('final-score').textContent = score;
            
            // Set result emoji and message
            const resultEmoji = document.getElementById('result-emoji');
            const resultMessage = document.getElementById('result-message');
            
            if (score >= 9) {
                resultEmoji.textContent = 'üèÜ';
                resultMessage.textContent = 'Fantastiskt! Du √§r en riktig Motocross-expert!';
            } else if (score >= 7) {
                resultEmoji.textContent = 'ü•á';
                resultMessage.textContent = 'Bra jobbat! Du har goda kunskaper om Motocross!';
            } else if (score >= 5) {
                resultEmoji.textContent = 'ü•à';
                resultMessage.textContent = 'Helt okej! Du kan lite om Motocross!';
            } else {
                resultEmoji.textContent = 'ü•â';
                resultMessage.textContent = 'Du beh√∂ver l√§sa p√• mer om Motocross!';
            }
            
            // Save high score
            saveHighScore(score);
        }

        function saveHighScore(score) {
            const difficulty = document.getElementById('difficulty-select').value;
            const highScores = getHighScores();
            const currentDate = new Date().toLocaleDateString('sv-SE');
            
            // Add new score
            // Determine name (prompt if no user context)
            let playerName = window.currentPlayerName;
            if (!playerName) {
                try {
                    const stored = localStorage.getItem('currentPlayerName');
                    if (stored) playerName = stored;
                } catch (e) {}
            }
            if (!playerName) {
                playerName = prompt('Ange namn f√∂r highscore (valfritt):', 'Anonym') || 'Anonym';
                try { localStorage.setItem('currentPlayerName', playerName); } catch (e) {}
            }

            highScores.push({
                score: score,
                difficulty: difficulty,
                date: currentDate,
                timestamp: Date.now(),
                name: playerName
            });
            
            // Sort by score (descending) and keep top 10
            highScores.sort((a, b) => b.score - a.score);
            const topScores = highScores.slice(0, 10);
            
            // Save to localStorage
            localStorage.setItem('motocrossQuizHighScores', JSON.stringify(topScores));
            
            // Show if it's a new high score
            if (score === topScores[0].score && topScores[0].timestamp === Date.now()) {
                showNewHighScore();
            }
        }

        function getHighScores() {
            const scores = localStorage.getItem('motocrossQuizHighScores');
            const arr = scores ? JSON.parse(scores) : [];
            // Backfill missing names using stored currentPlayerName
            let changed = false;
            let storedName = null;
            try { storedName = localStorage.getItem('currentPlayerName'); } catch (e) {}
            for (const s of arr) {
                if (!('name' in s) || !s.name) {
                    s.name = storedName || window.currentPlayerName || 'Anonym';
                    changed = true;
                }
            }
            if (changed) {
                try { localStorage.setItem('motocrossQuizHighScores', JSON.stringify(arr)); } catch (e) {}
            }
            return arr;
        }

        function showNewHighScore() {
            // Create a temporary high score notification
            const notification = document.createElement('div');
            notification.className = 'fixed top-4 right-4 bg-yellow-500 text-black font-bold px-6 py-3 rounded-lg shadow-lg z-50 animate-bounce';
            notification.innerHTML = 'üèÜ NYTT HIGHSCORE! üèÜ';
            document.body.appendChild(notification);
            
            setTimeout(() => {
                notification.remove();
            }, 3000);
        }

        function showExplanation(explanation) {
            // Create explanation box
            const explanationBox = document.createElement('div');
            explanationBox.className = 'mt-4 p-4 bg-blue-900 border-2 border-blue-400 rounded-lg text-center';
            explanationBox.innerHTML = `
                <div class="text-blue-300 font-semibold mb-2">üí° F√∂rklaring:</div>
                <div class="text-white">${explanation}</div>
            `;
            
            // Insert after options container
            const optionsContainer = document.getElementById('options-container');
            optionsContainer.parentNode.insertBefore(explanationBox, optionsContainer.nextSibling);
        }

        function playAgain() {
            document.getElementById('results-screen').classList.add('hidden');
            document.getElementById('start-screen').classList.remove('hidden');
        }

        function goHome() {
            window.location.href = '/';
        }

        function showHighScores() {
            const highScores = getHighScores();
            
            if (highScores.length === 0) {
                alert('Inga highscores √§nnu! Spela f√∂r att skapa en!');
                return;
            }
            
            let highScoreHTML = '<div class="quiz-card rounded-lg p-6 text-center">';
            highScoreHTML += '<h2 class="text-2xl font-bold text-cyan-400 mb-4">üèÜ Highscores</h2>';
            highScoreHTML += '<div class="space-y-2">';
            
            highScores.forEach((score, index) => {
                const medal = index === 0 ? 'ü•á' : index === 1 ? 'ü•à' : index === 2 ? 'ü•â' : 'üèÖ';
                const difficultyText = score.difficulty === 'easy' ? 'L√§tt' : score.difficulty === 'medium' ? 'Medium' : 'Sv√•r';
                highScoreHTML += `<div class="flex justify-between items-center bg-gray-700 p-3 rounded-lg">
                    <span class="text-2xl">${medal}</span>
                    <span class="text-white font-bold">${score.score}/10</span>
                    <span class="text-gray-300">${difficultyText}</span>
                    <span class="text-gray-200">${score.name || 'Anonym'}</span>
                    <span class="text-gray-400 text-sm">${score.date}</span>
                </div>`;
            });
            
            highScoreHTML += '</div>';
            highScoreHTML += '<button onclick="playAgain()" class="btn-primary px-6 py-3 rounded-lg mt-4">üîÑ Spela igen</button>';
            highScoreHTML += '</div>';
            
            // Replace the results screen with high scores
            document.getElementById('results-screen').innerHTML = highScoreHTML;
        }

        // Utility functions
        function shuffleArray(array) {
            const shuffled = [...array];
            for (let i = shuffled.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [shuffled[i], shuffled[j]] = [shuffled[j], shuffled[i]];
            }
            return shuffled;
        }
    </script>
</body>
</html>
